!function(e){e.fn.columnize=function(t){function s(e,t){try{e.append(t)}catch(s){e[0].appendChild(t[0])}}this.cols=[],this.offset=0,this.before=[],this.lastOther=0,this.prevMax=0,this.debug=0,this.setColumnStart=null,this.elipsisText="";var i={width:400,columns:!1,buildOnce:!1,overflow:!1,doneFunc:function(){},target:!1,ignoreImageLoading:!0,columnFloat:"left",lastNeverTallest:!1,accuracy:!1,precise:!1,manualBreaks:!1,cssClassPrefix:"",cssClassClear:"clear",cssClassCol:"column",elipsisText:"...",debug:0};return t=e.extend(i,t),"string"==typeof t.width&&(t.width=parseInt(t.width,10),isNaN(t.width)&&(t.width=i.width)),"function"==typeof t.setColumnStart&&(this.setColumnStart=t.setColumnStart),"string"==typeof t.elipsisText&&(this.elipsisText=t.elipsisText),t.debug&&(this.debug=t.debug),t.setWidth||(t.setWidth=t.precise?function(e){return 100/e}:function(e){return Math.floor(100/e)}),this.each(function(){function n(e,t){var s=t?".":"";return m.length?s+m+"-"+e:s+e}function l(i,l,o,r){for(;(g||o.height()<r)&&l[0].childNodes.length;){var a=l[0].childNodes[0];if(e(a).find(n("columnbreak",!0)).length)return;if(e(a).hasClass(n("columnbreak")))return;s(i,e(a))}if(0!==i[0].childNodes.length){var h=i[0].childNodes,d=h[h.length-1];i[0].removeChild(d);var f=e(d);if(3==f[0].nodeType){var c,u=f[0].nodeValue,m=t.width/18,v=null;for(t.accuracy&&(m=t.accuracy);o.height()<r&&u.length;){var p=u.indexOf(" ",m);c=-1!=p?u.substring(0,p):u,v=document.createTextNode(c),s(i,e(v)),u=u.length>m&&-1!=p?u.substring(p):""}if(o.height()>=r&&null!==v&&(i[0].removeChild(v),u=v.nodeValue+u),!u.length)return!1;f[0].nodeValue=u}return l.contents().length?l.prepend(f):s(l,f),3==f[0].nodeType}}function o(e,t,i,r){if(!e.contents(":last").find(n("columnbreak",!0)).length&&!e.contents(":last").hasClass(n("columnbreak"))&&t.contents().length){var a=t.contents(":first");if("undefined"==typeof a.get(0)||1!=a.get(0).nodeType)return;var h=a.clone(!0);if(a.hasClass(n("columnbreak")))s(e,h),a.remove();else if(g)s(e,h),a.remove();else if(1==h.get(0).nodeType&&!h.hasClass(n("dontend")))if(s(e,h),h.is("img")&&i.height()<r+20)a.remove();else if(a.hasClass(n("dontsplit"))&&i.height()<r+20)a.remove();else if(h.is("img")||a.hasClass(n("dontsplit")))h.remove();else{if(h.empty(),l(h,a,i,r))a.addClass(n("split"));else{if(a.addClass(n("split")),"OL"==a.get(0).tagName){var d=h.get(0).childElementCount+h.get(0).start;a.attr("start",d+1)}a.children().length&&o(h,a,i,r)}if(0===h.get(0).childNodes.length)h.remove(),a.removeClass(n("split"));else if(1==h.get(0).childNodes.length){var f=h.get(0).childNodes[0];if(3==f.nodeType){var c=/\s/,u=f.nodeValue;c.test(u)&&(h.remove(),a.removeClass(n("split")))}}}}}function r(){if(!d.data("columnized")||1!=d.children().length){if(d.data("columnized",!0),d.data("columnizing",!0),d.empty(),d.append(e("<div class='"+n("first")+" "+n("last")+" "+n(p)+" '></div>")),$col=d.children().eq(d.children().length-1),$destroyable=c.clone(!0),t.overflow){for(targetHeight=t.overflow.height,l($col,$destroyable,$col,targetHeight),$destroyable.contents().find(":first-child").hasClass(n("dontend"))||o($col,$destroyable,$col,targetHeight);$col.contents(":last").length&&a($col.contents(":last").get(0));){var i=$col.contents(":last");i.remove(),$destroyable.prepend(i)}for(var r="",h=document.createElement("DIV");$destroyable[0].childNodes.length>0;){var f=$destroyable[0].childNodes[0];if(f.attributes)for(var u=0;u<f.attributes.length;u++)0===f.attributes[u].nodeName.indexOf("jQuery")&&f.removeAttribute(f.attributes[u].nodeName);h.innerHTML="",h.appendChild($destroyable[0].childNodes[0]),r+=h.innerHTML}var g=e(t.overflow.id)[0];g.innerHTML=r}else s($col,$destroyable.contents());d.data("columnizing",!1),t.overflow&&t.overflow.doneFunc&&t.overflow.doneFunc(),t.doneFunc()}}function a(t){return 3==t.nodeType?/^\s+$/.test(t.nodeValue)&&t.previousSibling?a(t.previousSibling):!1:1!=t.nodeType?!1:e(t).hasClass(n("dontend"))?!0:0===t.childNodes.length?!1:a(t.childNodes[t.childNodes.length-1])}function h(){if(adjustment=0,u!=d.width()){u=d.width();var i=Math.round(d.width()/t.width),h=t.width,m=t.height;if(t.columns&&(i=t.columns),g&&(i=c.find(n("columnbreak",!0)).length+1,h=!1),1>=i)return r();if(!d.data("columnizing")){d.data("columnized",!0),d.data("columnizing",!0),d.empty(),d.append(e("<div style='width:"+t.setWidth(i)+"%; float: "+t.columnFloat+";'></div>")),N=d.children(":last"),s(N,c.clone()),f=N.height(),d.empty();var b=f/i,C=3,y=!1;t.overflow?(C=1,b=t.overflow.height):m&&h&&(C=1,b=m,y=!0);for(var w=0;C>w&&20>w;w++){d.empty();var x,T,N,O;try{x=c.clone(!0)}catch(L){x=c.clone()}x.css("visibility","hidden");for(var $=0;i>$;$++)T=0===$?n("first"):"",T+=(""!=T?" ":"")+n(p),T=$==i-1?n("last")+" "+T:T,d.append(e("<div class='"+T+"'></div>"));for($=0;$<i-(t.overflow?0:1)||y&&x.contents().length;){for(d.children().length<=$&&d.append(e("<div class='"+T+"'></div>")),N=d.children().eq($),y&&N.width(h+"px"),l(N,x,N,b),o(N,x,N,b);N.contents(":last").length&&a(N.contents(":last").get(0));)O=N.contents(":last"),O.remove(),x.prepend(O);$++,0===N.contents().length&&x.contents().length?N.append(x.contents(":first")):$!=i-(t.overflow?0:1)||t.overflow||x.find(n("columnbreak",!0)).length&&i++}if(t.overflow&&!y){var M=!1,k=document.all&&-1!=navigator.appVersion.indexOf("MSIE 7.");if(M||k){for(var I="",S=document.createElement("DIV");x[0].childNodes.length>0;){var z=x[0].childNodes[0];for($=0;$<z.attributes.length;$++)0===z.attributes[$].nodeName.indexOf("jQuery")&&z.removeAttribute(z.attributes[$].nodeName);S.innerHTML="",S.appendChild(x[0].childNodes[0]),I+=S.innerHTML}var H=e(t.overflow.id)[0];H.innerHTML=I}else e(t.overflow.id).empty().append(x.contents().clone(!0))}else if(y)d.children().each(function(e){N=d.children().eq(e),N.width(h+"px"),0===e?N.addClass(n("first")):e==d.children().length-1?N.addClass(n("last")):(N.removeClass(n("first")),N.removeClass(n("last")))}),d.width(d.children().length*h+"px");else{N=d.children().eq(d.children().length-1),x.contents().each(function(){N.append(e(this))});var F=(N.height(),1e7),B=max=numberOfColumnsThatDontEndInAColumnBreak=0,V=!1;d.children().each(function(e){return function(t){var s=e.children().eq(t),i=s.children(":last").find(n("columnbreak",!0)).length;if(!i){var l=s.height();V=!1,B+=l,l>max&&(max=l,V=!0),F>l&&(F=l),numberOfColumnsThatDontEndInAColumnBreak++}}}(d));var E=B/numberOfColumnsThatDontEndInAColumnBreak;0===B?w=C:t.lastNeverTallest&&V?(adjustment+=5,b+=30,w==C-1&&C++):max-F>30?b=E+30:Math.abs(E-b)>20?b=E:w=C}d.append(e("<div class='"+v+"' />"))}d.find(n(p,!0)).find(":first"+n("removeiffirst",!0)).remove(),d.find(n(p,!0)).find(":last"+n("removeiflast",!0)).remove(),d.find(n("split",!0)).find(":first"+n("removeiffirst",!0)).remove(),d.find(n("split",!0)).find(":last"+n("removeiflast",!0)).remove(),d.data("columnizing",!1),t.overflow&&t.overflow.doneFunc(),t.doneFunc()}}}var d=e(t.target?t.target:this),f=e(this).height(),c=e("<div></div>"),u=adjustment=0,g=t.manualBreaks,m=i.cssClassPrefix,v=i.cssClassClear,p=i.cssClassCol;if("string"==typeof t.cssClassPrefix&&(m=t.cssClassPrefix),"string"==typeof t.cssClassClear&&(v=t.cssClassClear),"string"==typeof t.cssClassCol&&(p=t.cssClassCol),s(c,e(this).contents().clone(!0)),!t.ignoreImageLoading&&!t.target&&!d.data("imageLoaded")&&(d.data("imageLoaded",!0),e(this).find("img").length>0)){var b=function(e,i){return function(){e.data("firstImageLoaded")||(e.data("firstImageLoaded","true"),s(e.empty(),i.children().clone(!0)),e.columnize(t))}}(e(this),c);return e(this).find("img").one("load",b),void e(this).find("img").one("abort",b)}d.empty().addClass("columnized"),h(),t.buildOnce||e(window).resize(function(){t.buildOnce||(d.data("timeout")&&clearTimeout(d.data("timeout")),d.data("timeout",setTimeout(h,200)))})})},e.fn.renumberByJS=function(t,s,i,n){if(this.setList=function(t,s,i){var n,l=this.before.parents();if(n=e(t[this.offset-1]).find(">*"),n.last()[0].tagName!=i.toUpperCase())return this.debug&&console.log("Last item in previous column, isn't a list..."),0;n=n.length;var o=1;if(o=this.lastOther<=0?this.before.children().length+1:e(l[this.lastOther]).children().length+1,e(t[this.offset]).find(i+":first li.split").length){var r=e(t[this.offset-1]).find(i+":last li:last");if(""===this.elipsisText||e(t[this.offset-1]).find(i+":last ~ div").length||e(t[this.offset-1]).find(i+":last ~ p").length);else if(0==e(r).find("ul, ol, dl").length){var a=r.last().text(),h=a.length;";"==a.substring(h-1)?a.substring(h-4)!=this.elipsisText+";"&&(a=a.substring(0,h-1)+this.elipsisText+";"):a.substring(h-3)!=this.elipsisText&&(a+=this.elipsisText),r.last().text(a)}0==e(t[this.offset]).find(i+":first >li.split >"+i).length&&o--}if(1==n&&(o+=this.prevMax),this.nest>1){this.debug&&console.log("Supposed to be a nested list...decr"),o--;var d=e(t[this.offset-1]).find(i+":first li.split:first");d.length>0&&(this.debug&&console.log("Previous column started with a split item, so that count is one less than expected"),o--),d=e(t[this.offset]).find(i+":first li:first").clone(),d.children().remove(),e.trim(d.text()).length>0&&(this.debug&&console.log("If that was a complete list in the previous column, don't decr."),o++,0==e(t[this.offset-1]).find(">"+i+":last ").children().length&&(this.debug&&console.log("unless that was empty, in which case revert"),o--))}else{var d=e(t[this.offset]).find(i+":first li:first "+i+".split li.split");d.length>0&&(this.debug&&console.log("[Nested] Column started with a split item, so that count is one less than expected"),o--)}return this.debug&&console.log("Setting the start value to "+o+" ("+this.prevMax+")"),o>0&&("function"==typeof this.setColumnStart?this.setColumnStart(s,o):s.attr("start",o)),0},"undefined"==typeof i&&(i=!1),"undefined"==typeof n&&(n=!1),!i&&!n)throw"renumberByJS(): Bad param, must pass an id or a class";var l="";this.prevMax=1,l=n?"."+n:"#"+i;var o=t.toLowerCase(),r=t.toUpperCase();for(this.cols=e(l),this.debug&&console.log("There are "+this.cols.length+" items, looking for "+o),this.before=e(this.cols[0]).find(o+":last"),this.prevMax=this.before.children().length,this.offset=1;this.offset<this.cols.length;this.offset++)if(this.debug&&console.log("iterating "+this.offset+"...[of "+this.cols.length+"]"),this.offset%s!=0){if(this.before=e(this.cols[this.offset-1]).find(o+":last"),this.before.length){this.debug&&console.log("Have some "+t+" elements in the previous column");var a=e(this.cols[this.offset]).find(o+":first"),h=e(this.cols[this.offset]).find("*:first");if(h[0]!==a[0])continue;var d=this.before.parents();this.lastOther=0;for(var f=!1;this.lastOther<d.length;this.lastOther++)if(d[this.lastOther].tagName!=r&&"LI"!=d[this.lastOther].tagName){f=!0,this.lastOther--;break}this.nest=1,e(this.cols[this.offset]).find(">"+o+":first li "+o+":first").length&&(this.nest=2),this.setList(this.cols,a,o),this.lastOther--,a=e(this.cols[this.offset]).find(o+":first li "+o+":first"),a.length&&(this.before=e(this.cols[this.offset-1]).find(">"+o+":last li "+o+":last"),this.prevMax=0,this.nest=1,this.setList(this.cols,a,o));var c=e(this.cols[this.offset-1]).find(">"+o+":last");this.prevMax=c.children().length}}else this.debug&&console.log("First column (in theory..)"),this.prevMax=1;return 0}}(jQuery);
